---
layout: post
title: Motifs
author: "Tobias Madsen"
tags: [example]
---



<!--
Build post
setwd("../gh-pages-dgRaph/")
library(knitr)
render_jekyll()
knit(input = "../gh-pages-dgRaph/knitr//motifs.Rmd", output = "../gh-pages-dgRaph/_posts/2015-06-26-Motifs.md")
setwd("../dgRaph/")
-->

A motif is a sequence of DNA that is often found in multiple instances with little to no variation throughout the genome, which enables a biological function. These a described using a so-called PWMs(Position Weighted Matrices, sometimes also PSSMs). Which is simply a matrix describing the frequencies of each base at each position.


{% highlight r %}
pwm <- matrix(c(0.4, 0.1, 0.6,  0.4, 0.3,
                0.1, 0.7, 0.3,  0.1, 0.65,
                0.1, 0.1, 0.05, 0.1, 0.025,
                0.4, 0.1, 0.05, 0.4, 0.025) ,4,5, byrow = T)

row.names(pwm) <- c('A', 'C', 'G', 'T')
data.frame(pwm)
{% endhighlight %}



{% highlight text %}
##    X1  X2   X3  X4    X5
## A 0.4 0.1 0.60 0.4 0.300
## C 0.1 0.7 0.30 0.1 0.650
## G 0.1 0.1 0.05 0.1 0.025
## T 0.4 0.1 0.05 0.4 0.025
{% endhighlight %}

> Personally, I think this is an abomination of a plot, and hope there isn't a way in ggplot2 to do it!
> -Hadley

Building a factor graph for the background distribution. 


{% highlight r %}
library(dgRaph)
varDim <- c(rep(4,5),rep(100,5))
facPot <- list(multinomialPotential(dim = c(1, 4)), # Prior
               multinomialPotential(dim = c(4, 4)), # Transition
               betaPotential(dim = c(4, 100))) # Emission
facNbs <- list(1, 
               c(1,2), c(2,3), c(3,4), c(4,5),
               c(1,6), c(2,7), c(3,8), c(4,9), c(5,10))
potMap <- c(1,2,2,2,2,3,3,3,3,3)

bgDfg <- dfg(varDim, facPot, facNbs, potMap,
             varNames = c("X1","X2","X3","X4","X5","Y1","Y2","Y3","Y4","Y5"))
{% endhighlight %}

Plot the graph:


{% highlight r %}
plot(bgDfg, layout = layout.reingold.tilford)
{% endhighlight %}

![center](/dgRaph/figs/motifs/motifbgPlot-1.png) 

The data to be used for training the background can be downloaded [here]({{ site.baseurl}}/downloads/motif/df.tab) and similarly for the foreground [here]({{ site.baseurl}}/downloads/motif/dfmotif.tab).

First we train the background.


{% highlight r %}
bgDfg <- train(data = df, dfg = bgDfg, 
               optim = c('row', 'row', 'beta'), verbose = T)
{% endhighlight %}



{% highlight text %}
## Training...
## Iterations:..............
## EM-algorithm converged after 14 iterations
## Likelihood: -25431.79
{% endhighlight %}

![plot of chunk learning1](/dgRaph/figs/motifs/learning1-1.png) 

{% highlight text %}
## 1th potential
## Row normalized multinomial potential
## 	1	2	3	4
## 1	0.26983	0.23801	0.24829	0.24386
## 
## 2th potential
## Row normalized multinomial potential
## 	1	2	3	4
## 1	0.41565	0.07958	0.12378	0.38099
## 2	0.13434	0.37403	0.39234	0.099297
## 3	0.11646	0.41907	0.38714	0.077333
## 4	0.39591	0.095157	0.1045	0.40443
## 
## 3th potential
## beta-potential update
## 1	alpha:	2.0295	beta:	5.1511
## 2	alpha:	5.4467	beta:	2.126
## 3	alpha:	5.0221	beta:	1.8588
## 4	alpha:	1.841	beta:	4.241
{% endhighlight %}

Similarly we build and train a motif model



### Significance evalution

Significance evaluation using importance sampling


{% highlight r %}
x <- seq(-6,4,0.01)
dfis <- tailIS(x, n=10000, alpha=1, dfg1 = bgDfg, dfg2 = motifDfg)
head(dfis)
{% endhighlight %}



{% highlight text %}
##       x         p       low     high   p_lower alpha
## 1 -6.00 0.8397932 0.7273483 0.952238 0.1602068     1
## 2 -5.99 0.8397932 0.7273483 0.952238 0.1602068     1
## 3 -5.98 0.8397932 0.7273483 0.952238 0.1602068     1
## 4 -5.97 0.8397932 0.7273483 0.952238 0.1602068     1
## 5 -5.96 0.8397932 0.7273483 0.952238 0.1602068     1
## 6 -5.95 0.8397932 0.7273483 0.952238 0.1602068     1
{% endhighlight %}

And a plot of the tail distribution found using importance sampling including confidence interval

![plot of chunk importancePlot](/dgRaph/figs/motifs/importancePlot-1.png) 

We can also use saddlepoint approximation 


{% highlight r %}
x <- seq(-6,4,0.01)
dfSaddle <- tailSaddle(x, dfg1 = bgDfg, dfg2 = motifDfg)
head(dfis)
{% endhighlight %}



{% highlight text %}
##       x         p       low     high   p_lower alpha
## 1 -6.00 0.8397932 0.7273483 0.952238 0.1602068     1
## 2 -5.99 0.8397932 0.7273483 0.952238 0.1602068     1
## 3 -5.98 0.8397932 0.7273483 0.952238 0.1602068     1
## 4 -5.97 0.8397932 0.7273483 0.952238 0.1602068     1
## 5 -5.96 0.8397932 0.7273483 0.952238 0.1602068     1
## 6 -5.95 0.8397932 0.7273483 0.952238 0.1602068     1
{% endhighlight %}


{% highlight text %}
## Warning: Removed 1 rows containing missing values (geom_path).
{% endhighlight %}

![plot of chunk saddlePlot](/dgRaph/figs/motifs/saddlePlot-1.png) 
